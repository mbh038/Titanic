pbinom(450,1000,0.4)-pbinom(350,1000,0.4)
exact<-pbinom(450,1000,0.4)-pbinom(350,1000,0.4)
b<-(450 - 1000*.4)/sqrt(1000*.4*.6)
a<-(350 - 1000*.4)/sqrt(1000*.4*.6)
normApprox<-pnorm(b)-pnorm(a)
exact-normApprox
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
for (N in Ns){
2*N
}
probs=data.frame(c("exact","approx"))
probs=data.frame("exact","approx")
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs=data.frame("exact","approx")
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=rbind(probs,c(exact,approx))
}
}
probs
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=rbind(probs,c(exact,approx))
}
}
probs
N<-6
k<-seq(1,N-1)
k
N<-5
p<-0.01
k<-seq(1,N-1)
k
exact = dbinom(k,N,p)
exact
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=rbind(probs,c(exact,approx))
approx
probs
probs<-data.frame(exact=numeric(),approx=numeric())
probs
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=rbind(probs,c(exact,approx))
probs
probs=cbind(exact,approx)
probs
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx)
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx)
abline(0,1,col="red")
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx,main=N)
abline(0,1,col="red")
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx,main="N=",N,"p=",p)
abline(0,1,col="red")
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx,main=paste("N=",N," p=",p))
abline(0,1,col="red")
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
probs<-data.frame(exact=numeric(),approx=numeric())
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
probs=cbind(exact,approx)
plot(exact,approx,main=paste("N=",N," p=",p))
abline(0,1,col="red")
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
library(rafalib)
mypar2(4,5)
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
LIM <- range(c(approx,exact))
plot(exact,approx,main=paste("N =",N," p = ",p),xlim=LIM,ylim=LIM,col=1,pch=16)
abline(0,1)
}
}
mypar(4,5)
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
library(rafalib)
mypar(4,5)
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
LIM <- range(c(approx,exact))
plot(exact,approx,main=paste("N =",N," p = ",p),xlim=LIM,ylim=LIM,col=1,pch=16)
abline(0,1)
}
}
Ns <- c(5,10,30,100)
ps <- c(0.01,0.10,0.5,0.9,0.99)
#library(rafalib)
mypar(4,5)
for (N in Ns){
k<-seq(1,N-1)
for (p in ps){
exact = dbinom(k,N,p)
a <- (k+0.5 - N*p)/sqrt(N*p*(1-p))
b <- (k-0.5 - N*p)/sqrt(N*p*(1-p))
approx = pnorm(a) - pnorm(b)
LIM <- range(c(approx,exact))
plot(exact,approx,main=paste("N =",N," p = ",p),xlim=LIM,ylim=LIM,col=1,pch=16)
abline(0,1)
}
}
library(devtools)
install_github("genomicsclass/dagdata")
library(dagdata)
data(hcmv)
library(rafalib)
mypar()
plot(locations,rep(1,length(locations)),ylab="",yaxt="n")
breaks=seq(0,4000*round(max(locations)/4000),4000)
tmp=cut(locations,breaks)
counts=as.numeric(table(tmp))
hist(counts)
probs <- dpois(counts,4)
likelihood <- prod(probs)
likelihood
?prod
logprobs <- dpois(counts,4,log=TRUE)
loglikelihood <- sum(logprobs)
loglikelihood
?dpois
$\tiny{2}\\small{4}\large{8}\huge{16}$
setwd("C:/Users/Mike/Rspace/Titanic")
set.seed(1)
rm(list=ls())
dataTrain<-read.csv("./data/train.csv")
dataTest<-read.csv("./data/test.csv")
#str(dataTrain)
#summary(dataTrain)
str(dataTrain)
set.seed(1)
rm(list=ls())
dataTrain<-read.csv("./data/train.csv")
dataTest<-read.csv("./data/test.csv")
#str(dataTrain)
#summary(dataTrain)
dataTest$Survived <- NA
combi <- rbind(dataTrain, dataTest)
summary(combi)
summary(combi$Embarked)
combi$Embarked[which(combi$Embarked == '')]<-"S"
summary(combi$Embarked)
combi$Embarked <- factor(combi$Embarked)
summary(combi$Embarked)
# make title variable
combi$Name <- as.character(combi$Name)
#strsplit(combi$Name[1], split='[,.]')[[1]][2]
combi$Title <- sapply(combi$Name, FUN=function(x) {strsplit(x, split='[,.]')[[1]][2]})
combi$Title <- sub(' ', '', combi$Title)
table(combi$Title)
combi$Title[combi$Title %in% c('Mme', 'Mlle','Ms')] <- 'Mlle'
combi$Title[combi$Title %in% c('Capt', 'Don', 'Major', 'Sir','Jonkheer')] <- 'Sir'
combi$Title[combi$Title %in% c('Dona', 'Lady', 'the Countess')] <- 'Lady'
table(combi$Title)
combi$Title<-factor(combi$Title)
# make family size variable
combi$FamilySize <- combi$SibSp + combi$Parch + 1
# make familyID variable
combi$Surname <- sapply(combi$Name, FUN=function(x) {strsplit(x, split='[,.]')[[1]][1]})
combi$FamilyID <- paste(as.character(combi$FamilySize), combi$Surname, sep="")
combi$FamilyID[combi$FamilySize <= 2] <- 'Small'
famIDs <- data.frame(table(combi$FamilyID))
famIDs <- famIDs[famIDs$Freq <= 2,]
combi$FamilyID[combi$FamilyID %in% famIDs$Var1] <- 'Small'
combi$FamilyID <- factor(combi$FamilyID)
table(combi$FamilyID)
# reduce levels
combi$FamilyID2 <- combi$FamilyID
combi$FamilyID2 <- as.character(combi$FamilyID2)
combi$FamilyID2[combi$FamilySize <= 3] <- 'Small'
combi$FamilyID2 <- factor(combi$FamilyID2)
# make cabin variable
cabins<-function(x){
cabinLevels<-c("A","B","C","D","E","F","G","H","T")
x<-as.character(x)
x<-substr(x, 1, 1)
x[x==""] <- "H"
newX<-as.factor(x)
levels(newX)<-cabinLevels
invisible(newX)
}
combi$Cabin<-cabins(combi$Cabin)
#normalise age variable
combi$Age<-(combi$Age-mean(combi$Age,na.rm=TRUE))/sd(combi$Age,na.rm=TRUE)
library(rpart)
# impute missing age values
Agefit <- rpart(Age ~ Pclass + Sex + SibSp + Parch + Fare + Embarked + Title + FamilySize,
data=combi[!is.na(combi$Age),], method="anova")
combi$Age[is.na(combi$Age)] <- predict(Agefit, combi[is.na(combi$Age),])
summary(combi$Age)
# impute missing fare value
Farefit <- rpart(Fare ~ Pclass + Sex + SibSp + Parch + Embarked + Title + FamilySize,
data=combi[!is.na(combi$Fare),], method="anova")
combi$Fare[is.na(combi$Fare)] <- predict(Farefit, combi[is.na(combi$Fare),])
summary(combi$Fare)
Farefit <- rpart(Fare ~ Pclass + Sex + SibSp + Parch + Embarked + Title + FamilySize,
data=combi[combi$Fare!=0,], method="anova")
combi$Fare[combi$Fare==0] <- predict(Farefit, combi[combi$Fare==0,])
summary(combi$Fare)
#transform fare values
combi$Fare<-log(combi$Fare)
hist(combi$Fare)
summary(combi$Fare)
dataTrain <- combi[1:891,]
dataTest <- combi[892:1309,]
table(dataTrain$Cabin)
table(dataTest$Cabin)
library(caTools)
set.seed(1000)
spl = sample.split(dataTrain$Survived, SplitRatio = 0.8)
train = subset(dataTrain, spl==TRUE)
test = subset(dataTrain, spl==FALSE)
table(train$Cabin)
table(test$Cabin)
#   sex="female"
#   # train on one gender at a time
#   train<-subset(train,Sex==sex)
#   #train$Sex<-factor(train$Sex)
#   test<-subset(test,Sex==sex)
#   #test$Sex<-factor(test$Sex)
#   dataTest<-subset(dataTest,Sex==sex)
#   #dataTest$Sex<-factor(dataTest$Sex)
#train$Survived<-as.factor(train$Survived)
#test$Survived<-as.factor(test$Survived)
#   train$Cabin<-as.factor(train$Cabin)
#   test$Cabin<-as.factor(test$Cabin)
#   train$Cabin<-factor(train$Cabin)
#   test$Cabin<-factor(test$Cabin)
#   levels(test$Cabin) <- levels(train$Cabin)
## Models
model<-function(x){
md=list(8)
md[[1]]<-c(as.formula("as.factor(Survived)~Sex+Pclass"),2)
md[[2]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare"),3)
md[[3]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+Age"),4)
md[[4]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+Age+FamilySize"),6) # Age na rows removed
md[[5]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+Age+Title +FamilyID2+FamilySize +Cabin"),8)
md[[6]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID"),10)
md[[7]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID+Cabin"),11)
md[[8]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age +Fare + Embarked + Title + FamilySize + FamilyID+Cabin"),9)
md[[x]]
}
# Number of folds
set.seed(2)
tr.control = trainControl(method = "cv", number = 10)
#Test cp values from 0.002 to 0.1 in 0.002 increments
cartGrid = expand.grid( .cp = seq(0.001,0.1,0.001))
for (j in 1:8){
glm.fit=glm(model(j)[[1]],data=train,family=binomial)
#levels(train$FamilyID)<-levels(train$FamilyID)
glm.probs<- predict(glm.fit, newdata = test, type = "response")
# find optimum threshold
maxThreshold<-0
glm.accMax<-0
thresholds<-seq(.2, .9, length.out=50 )
glm.acc=rep(0,length(thresholds))
for (i in 1:length(thresholds)){
glm.pred=rep(0,length(test$Survived))
glm.pred[glm.probs>thresholds[i]]=1
glm.acc[i]<-sum(glm.pred==test$Survived)/nrow(test)
if (glm.acc[i] > glm.accMax) {
glm.accMax = glm.acc[i]
maxThreshold=thresholds[i]
}
}
plot(thresholds,glm.acc)
glm.pred=rep(0,length(test$Survived))
glm.pred[glm.probs>maxThreshold]=1
print (paste(round(maxThreshold,3)," ",sum(glm.pred==test$Survived)/nrow(test)))
}
glm.fit=glm(model(8)[[1]],data=dataTrain,family=binomial)
glm.probs<- predict(glm.fit, newdata = dataTest, type = "response")
glm.pred=rep(0,nrow(dataTest))
glm.pred[glm.probs>0.44]=1
submission<-data.frame(dataTest$PassengerId,glm.pred)
names(submission)<-c("PassengerId","Survived")
write.table(submission,"./submissions/glm8.csv",sep=",",row.names=FALSE)
## CART with cross validation
## Selecting Cp by cross-validation
library(lattice)
library(ggplot2)
library(rpart)
library(rpart)
library(rpart.plot)
library(caret)
library(e1071)
# Number of folds
set.seed(2)
tr.control = trainControl(method = "cv", number = 10)
#Test cp values from 0.002 to 0.1 in 0.002 increments
cartGrid = expand.grid( .cp = seq(0.001,0.01,0.0001))
# Cross-validation
#start()
bestCp<-vector()
for (i in 1:8){
set.seed(2)
tr = train(model(i)[[1]], data = dataTrain, method = "rpart", trControl = tr.control, tuneGrid = cartGrid)
tr
# Extract tree
best.tree = tr$finalModel
prp(best.tree)
bestCp[i]=tr$results$cp[which(tr$results$Accuracy==max(tr$results$Accuracy))][1]
print (paste("Model: ",i,"Cp: ",bestCp[i],"accuracy: ",max(tr$results$Accuracy),sep=" "))
set.seed(2)
CARTcp = rpart(model(i)[[1]], data=dataTrain, method="class",cp=bestCp[i])
prp(CARTcp)
# 2.4 accuracy
#     PredictCARTcp = predict(CARTcp, newdata = test, type = "class")
#     acc<-sum(PredictCARTcp==test$Survived)/nrow(test)
#     print (acc)
#     if (acc > accbest){
#         accbest=acc
#         ibest =i
#     }
}
model<-function(x){
md=list(8)
md[[1]]<-c(as.formula("as.factor(Survived)~Sex+Pclass"),2)
md[[2]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare"),3)
md[[3]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+FamilySize"),4)
md[[4]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+Age+FamilySize"),5) # Age na rows removed
md[[5]]<-c(as.formula("as.factor(Survived)~Sex+Pclass+Fare+Age+Title +FamilyID2+FamilySize +Cabin"),8)
md[[6]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID"),10)
md[[7]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + FamilySize + FamilyID+Cabin"),11)
md[[8]]<-c(as.formula("as.factor(Survived) ~ Pclass + Sex + Age +Fare + Embarked + Title + FamilySize + FamilyID+Cabin"),9)
md[[x]]
}
# Number of folds
set.seed(2)
tr.control = trainControl(method = "cv", number = 10)
#Test cp values from 0.002 to 0.1 in 0.002 increments
cartGrid = expand.grid( .cp = seq(0.001,0.01,0.0001))
# Cross-validation
#start()
bestCp<-vector()
for (i in 1:4){
set.seed(2)
tr = train(model(i)[[1]], data = dataTrain, method = "rpart", trControl = tr.control, tuneGrid = cartGrid)
tr
# Extract tree
best.tree = tr$finalModel
prp(best.tree)
bestCp[i]=tr$results$cp[which(tr$results$Accuracy==max(tr$results$Accuracy))][1]
print (paste("Model: ",i,"Cp: ",bestCp[i],"accuracy: ",max(tr$results$Accuracy),sep=" "))
set.seed(2)
CARTcp = rpart(model(i)[[1]], data=dataTrain, method="class",cp=bestCp[i])
prp(CARTcp)
# 2.4 accuracy
#     PredictCARTcp = predict(CARTcp, newdata = test, type = "class")
#     acc<-sum(PredictCARTcp==test$Survived)/nrow(test)
#     print (acc)
#     if (acc > accbest){
#         accbest=acc
#         ibest =i
#     }
}
# Number of folds
set.seed(820)
tr.control = trainControl(method = "cv", number = 10)
#Test cp values from 0.002 to 0.1 in 0.002 increments
cartGrid = expand.grid( .cp = seq(0.001,0.01,0.0001))
# Cross-validation
#start()
bestCp<-vector()
for (i in 1:4){
set.seed(820)
tr = train(model(i)[[1]], data = dataTrain, method = "rpart", trControl = tr.control, tuneGrid = cartGrid)
tr
# Extract tree
best.tree = tr$finalModel
prp(best.tree)
bestCp[i]=tr$results$cp[which(tr$results$Accuracy==max(tr$results$Accuracy))][1]
print (paste("Model: ",i,"Cp: ",bestCp[i],"accuracy: ",max(tr$results$Accuracy),sep=" "))
set.seed(820)
CARTcp = rpart(model(i)[[1]], data=dataTrain, method="class",cp=bestCp[i])
prp(CARTcp)
# 2.4 accuracy
#     PredictCARTcp = predict(CARTcp, newdata = test, type = "class")
#     acc<-sum(PredictCARTcp==test$Survived)/nrow(test)
#     print (acc)
#     if (acc > accbest){
#         accbest=acc
#         ibest =i
#     }
}
set.seed(820)
tr.control = trainControl(method = "cv", number = 10)
#Test cp values from 0.002 to 0.1 in 0.002 increments
cartGrid = expand.grid( .cp = seq(0.001,0.01,0.0001))
# Cross-validation
#start()
bestCp<-vector()
for (i in 1:8){
set.seed(820)
tr = train(model(i)[[1]], data = dataTrain, method = "rpart", trControl = tr.control, tuneGrid = cartGrid)
tr
# Extract tree
best.tree = tr$finalModel
prp(best.tree)
bestCp[i]=tr$results$cp[which(tr$results$Accuracy==max(tr$results$Accuracy))][1]
print (paste("Model: ",i,"Cp: ",bestCp[i],"accuracy: ",max(tr$results$Accuracy),sep=" "))
set.seed(820)
CARTcp = rpart(model(i)[[1]], data=dataTrain, method="class",cp=bestCp[i])
prp(CARTcp)
# 2.4 accuracy
#     PredictCARTcp = predict(CARTcp, newdata = test, type = "class")
#     acc<-sum(PredictCARTcp==test$Survived)/nrow(test)
#     print (acc)
#     if (acc > accbest){
#         accbest=acc
#         ibest =i
#     }
}
